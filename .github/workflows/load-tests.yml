name: load-tests

on:
  push:
    branches: [ "main" ]

jobs:
  k6_cloud_test:
    name: k6 cloud test run
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: k6 Load Test
        uses: grafana/k6-action@v0.2.0
        with:
          filename: load_test.js
          env:
            API_URL=https://foundations.jetblue.com/jb-tom-demo/today
            REQUEST_THRESHOLD="p(95)<1500"
            REQUEST_COUNT="count < 15"

      - uses: actions/upload-artifact@v3
        with:
          name: results
          path: result.html
